{% extends "base.html" %}

{% block title %}Comprehensive Statistics - FLBB Statistics{% endblock %}

{% block page_title %}ðŸ“Š Comprehensive Statistics{% endblock %}
{% block page_description %}Detailed statistical analysis of games, players, and performance{% endblock %}

{% block content %}

        <div class="stats-section">
            <h2>Top 10 Highest Scoring Games</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Game ID</th>
                        <th>Home Team</th>
                        <th>Away Team</th>
                        <th>Score</th>
                        <th>Total Points</th>
                        <th>Division</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in highest_games.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['HomeTeamName'] }}</td>
                        <td>{{ row['AwayTeamName'] }}</td>
                        <td>{{ row['FinalHomeScore'] }} - {{ row['FinalAwayScore'] }}</td>
                        <td><strong>{{ row['TotalScore'] }}</strong></td>
                        <td>{{ row['GameDivisionDisplay'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="stats-section">
            <h2>Available Divisions</h2>
            <ul>
                {% for division in divisions %}
                <li><a href="/?division={{ division }}">{{ division }}</a></li>
                {% endfor %}
            </ul>
        </div>

        {% if team_stats is defined and not team_stats.empty %}
        <div class="stats-section">
            <h2>Top 10 Teams by Win Percentage</h2>
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Team</th>
                        <th>Games</th>
                        <th>Win %</th>
                        <th>Avg Points Scored</th>
                        <th>Avg Points Allowed</th>
                        <th>Point Diff</th>
                        <th>Highest Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in team_stats.head(10).iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td>{{ row['TotalGames'] }}</td>
                        <td><strong>{{ row['WinPercentage'] }}%</strong></td>
                        <td>{{ "%.1f"|format(row['AvgPointsScored']) }}</td>
                        <td>{{ "%.1f"|format(row['AvgPointsAllowed']) }}</td>
                        <td>{{ "%.1f"|format(row['PointsDifferential']) }}</td>
                        <td>{{ row['HighestScore'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <div class="stats-section">
            <h2>Player Statistics</h2>
            
            <!-- Top 20 Scorers -->
            <h3>Top 20 Scorers</h3>
            {% if top_scorers is defined and not top_scorers.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Games</th>
                        <th>Total Points</th>
                        <th>Avg Points/Game</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in top_scorers.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['PlayerName'] }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td>{{ row['GamesPlayed'] }}</td>
                        <td><strong>{{ row['TotalPoints'] }}</strong></td>
                        <td>{{ "%.1f"|format(row['AvgPointsPerGame']) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p><em>No player scoring data available.</em></p>
            {% endif %}

            <!-- Highest Single Game Score -->
            <h3>Highest Single Game Score</h3>
            {% if highest_single_score is defined and not highest_single_score.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Points</th>
                        <th>Game ID</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in highest_single_score.iterrows() %}
                    <tr>
                        <td>{{ row['PlayerName'] }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td><strong>{{ row['TotalPoints'] }}</strong></td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['GameDate'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Top 10 Three-Pointers -->
            <h3>Top 10 Three-Point Shooters</h3>
            {% if top_three_pointers is defined and not top_three_pointers.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>3-Pointers Made</th>
                        <th>Games</th>
                        <th>Avg 3PT/Game</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in top_three_pointers.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['PlayerName'] }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td><strong>{{ row['3PMadeShots'] }}</strong></td>
                        <td>{{ row['GamesPlayed'] }}</td>
                        <td>{{ "%.1f"|format(row['AvgThreePointsPerGame']) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Top Foulers -->
            <h3>Top 10 Foulers</h3>
            {% if top_foulers is defined and not top_foulers.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Team</th>
                        <th>Total Fouls</th>
                        <th>Games</th>
                        <th>Avg Fouls/Game</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in top_foulers.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['PlayerName'] }}</td>
                        <td>{{ row['Team'] }}</td>
                        <td><strong>{{ row['TotalFouls'] }}</strong></td>
                        <td>{{ row['GamesPlayed'] }}</td>
                        <td>{{ "%.1f"|format(row['AvgFoulsPerGame']) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <div class="stats-section">
            <h2>Referee Statistics</h2>
            
            <!-- Fouls Called Per Game -->
            <h3>Referees by Fouls Called Per Game</h3>
            {% if referee_fouls is defined and not referee_fouls.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Referee</th>
                        <th>Games</th>
                        <th>Avg Fouls/Game</th>
                        <th>Total Fouls</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in referee_fouls.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['RefereeName'] }}</td>
                        <td>{{ row['GamesRefereed'] }}</td>
                        <td><strong>{{ "%.1f"|format(row['AvgFoulsPerGame']) }}</strong></td>
                        <td>{{ row['FoulsCalledInGame'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Least Fouls Per Game -->
            <h3>Referees with Least Fouls Per Game (Min 2 Games)</h3>
            {% if referee_least_fouls is defined and not referee_least_fouls.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Referee</th>
                        <th>Games</th>
                        <th>Avg Fouls/Game</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in referee_least_fouls.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['RefereeName'] }}</td>
                        <td>{{ row['GamesRefereed'] }}</td>
                        <td><strong>{{ "%.1f"|format(row['AvgFoulsPerGame']) }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <div class="stats-section">
            <h2>Game Statistics</h2>
            
            <!-- Most Tie Scores -->
            <h3>Games with Most Tie Scores</h3>
            {% if most_ties is defined and not most_ties.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Game ID</th>
                        <th>Home Team</th>
                        <th>Away Team</th>
                        <th>Final Score</th>
                        <th>Tie Scores</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in most_ties.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['HomeTeam'] }}</td>
                        <td>{{ row['AwayTeam'] }}</td>
                        <td>{{ row['FinalHomeScore'] }} - {{ row['FinalAwayScore'] }}</td>
                        <td><strong>{{ row['TieScores'] }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Most Lead Changes -->
            <h3>Games with Most Lead Changes</h3>
            {% if most_lead_changes is defined and not most_lead_changes.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Game ID</th>
                        <th>Home Team</th>
                        <th>Away Team</th>
                        <th>Final Score</th>
                        <th>Lead Changes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in most_lead_changes.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['HomeTeam'] }}</td>
                        <td>{{ row['AwayTeam'] }}</td>
                        <td>{{ row['FinalHomeScore'] }} - {{ row['FinalAwayScore'] }}</td>
                        <td><strong>{{ row['LeadChanges'] }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Biggest Leads -->
            <h3>Games with Biggest Leads</h3>
            {% if biggest_leads is defined and not biggest_leads.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Game ID</th>
                        <th>Home Team</th>
                        <th>Away Team</th>
                        <th>Final Score</th>
                        <th>Biggest Lead</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in biggest_leads.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['HomeTeam'] }}</td>
                        <td>{{ row['AwayTeam'] }}</td>
                        <td>{{ row['FinalHomeScore'] }} - {{ row['FinalAwayScore'] }}</td>
                        <td><strong>{{ row['BiggestLead'] }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Biggest Wins -->
            <h3>Biggest Win Margins</h3>
            {% if biggest_wins is defined and not biggest_wins.empty %}
            <table>
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Game ID</th>
                        <th>Home Team</th>
                        <th>Away Team</th>
                        <th>Final Score</th>
                        <th>Win Margin</th>
                        <th>Winner</th>
                    </tr>
                </thead>
                <tbody>
                    {% for index, row in biggest_wins.iterrows() %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ row['GameId'] }}</td>
                        <td>{{ row['HomeTeam'] }}</td>
                        <td>{{ row['AwayTeam'] }}</td>
                        <td>{{ row['FinalHomeScore'] }} - {{ row['FinalAwayScore'] }}</td>
                        <td><strong>{{ row['WinMargin'] }}</strong></td>
                        <td>{{ row['Winner'] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>
{% endblock %}